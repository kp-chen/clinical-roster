{% extends "base.html" %}

{% block content %}
<h2>Generated Roster</h2>

{% if roster_config %}
<div style="background: #f5f5f5; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
    <h3>Roster Configuration</h3>
    <p><strong>File:</strong> {{ roster_config.filename }}</p>
    <p><strong>Period:</strong> {{ roster_config.start_date }} to {{ roster_config.end_date }}</p>
    <p><strong>Minimum Staff per Day:</strong> {{ roster_config.min_staff }}</p>
    {% if roster_config.specialty_column %}
    <p><strong>Specialty Column:</strong> {{ roster_config.specialty_column }}</p>
    {% endif %}
</div>
{% endif %}

{% if summary %}
<div style="background: #e8f5e8; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
    <h3>Summary Statistics</h3>
    <p><strong>Total Days:</strong> {{ summary.total_days }}</p>
    <p><strong>Coverage Rate:</strong> {{ summary.coverage_rate }}%</p>
    <p><strong>Days with Shortages:</strong> {{ summary.shortage_days }}</p>
    <p><strong>Total Staff Shortages:</strong> {{ summary.total_shortages }}</p>
</div>
{% endif %}

{% if roster_data %}
<div style="margin-top: 20px;">
    <h3>Daily Roster</h3>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="border: 1px solid #ddd; padding: 8px; background: #f2f2f2;">Date</th>
                <th style="border: 1px solid #ddd; padding: 8px; background: #f2f2f2;">Day</th>
                <th style="border: 1px solid #ddd; padding: 8px; background: #f2f2f2;">Assigned Staff</th>
                <th style="border: 1px solid #ddd; padding: 8px; background: #f2f2f2;">Available</th>
                <th style="border: 1px solid #ddd; padding: 8px; background: #f2f2f2;">Shortage</th>
                <th style="border: 1px solid #ddd; padding: 8px; background: #f2f2f2;">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for date, day_data in roster_data.items() %}
            <tr {% if day_data.shortage > 0 %}style="background: #ffe6e6;"{% endif %}>
                <td style="border: 1px solid #ddd; padding: 8px;">{{ day_data.date }}</td>
                <td style="border: 1px solid #ddd; padding: 8px;">{{ day_data.day }}</td>
                <td style="border: 1px solid #ddd; padding: 8px;">
                    {% if day_data.assigned_staff %}
                        {% for staff in day_data.assigned_staff %}
                            <div style="margin-bottom: 2px;">
                                {{ staff.name }}
                                {% if staff.specialty %}
                                    <span style="color: #666; font-size: 12px;">({{ staff.specialty }})</span>
                                {% endif %}
                            </div>
                        {% endfor %}
                    {% else %}
                        <em>No staff assigned</em>
                    {% endif %}
                </td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                    {{ day_data.total_available }}
                </td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                    {% if day_data.shortage > 0 %}
                        <strong style="color: #d32f2f;">{{ day_data.shortage }}</strong>
                    {% else %}
                        0
                    {% endif %}
                </td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                    {% if day_data.shortage > 0 %}
                        <span style="color: #d32f2f;">⚠️ Understaffed</span>
                    {% else %}
                        <span style="color: #2e7d32;">✅ Covered</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin-top: 20px;">
    <h3>Legend</h3>
    <ul>
        <li><span style="color: #2e7d32;">✅ Covered</span> - Day has minimum required staff</li>
        <li><span style="color: #d32f2f;">⚠️ Understaffed</span> - Day has insufficient staff (highlighted in red)</li>
        <li>Staff specialties are shown in parentheses when available</li>
    </ul>
</div>
{% else %}
<p>No roster data available. Please generate a roster first.</p>
{% endif %}

<div style="margin-top: 30px;">
    <a href="{{ url_for('index') }}" class="button">Start New Roster</a>
    <a href="{{ url_for('upload_leave') }}" class="button" style="margin-left: 10px;">Upload Different File</a>
</div>
{% endblock %}